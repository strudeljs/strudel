/*!
 * Strudel.js v0.7.0
 * (c) 2016-2018 Mateusz ≈Åuczak
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Strudel=e.Strudel||{})}(this,function(e){"use strict";function t(e,t){return new y(e,t)}function n(e){return function(t){return L(t,e)}}function r(e,t){return function(n,r){if(!e)throw new Error("Event descriptor must be provided for Evt decorator");n._events||(n._events=[]);var o=t?function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];n[r].apply(this,t),t[0].preventDefault()}:n[r];n._events[e]=o}}function o(e){return function(t,n){if(!e)throw new Error("Selector must be provided for El decorator");t._els||(t._els=[]),t._els[e]=n}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s={};s[/^\.[\w\-]+$/]=function(e){return document.getElementsByClassName(e.substring(1))},s[/^\w+$/]=function(e){return document.getElementsByTagName(e)},s[/^\#[\w\-]+$/]=function(e){return document.getElementById(e.substring(1))},s[/^</]=function(e){return(new y).generate(e)};var l=function(e,t){return(t||document).querySelectorAll(e)},h=function(e,t){if(e=e.replace(/^\s*/,"").replace(/\s*$/,""),t)return l(e,t);for(var n in s)if(t=n.split("/"),new RegExp(t[1],t[2]).test(e))return s[n](e);return l(e)},d={events:function(e,t){if(e._e)for(var n in e._e)e._e[n].forEach(function(e){new y(t).on(n,e)})},select:function(e,t){new y(e).is("select")&&(t.value=e.value)},textarea:function(e,t){new y(e).is("textarea")&&(t.value=e.value)}},y=function(){function e(t,n){if(u(this,e),t instanceof e)return t;"string"==typeof t&&(t=h(t,n)),(t&&t.nodeName||t&&t===window)&&(t=[t]),this._nodes=this.slice(t)}return c(e,[{key:"array",value:function(t){var n=this;return this._nodes.reduce(function(r,o,i){var u=void 0;return t?(u=t.call(n,o,i),u||(u=!1),"string"==typeof u&&(u=new e(u)),u instanceof e&&(u=u._nodes)):u=o.innerHTML,r.concat(!1!==u?u:[])},[])}},{key:"str",value:function(e,t){return function(n){return"function"==typeof n?n.call(this,e,t):n.toString()}}},{key:"is",value:function(e){return this.filter(e).length>0}},{key:"filter",value:function(t){var n=function(e){return e.matches=e.matches||e.msMatchesSelector||e.webkitMatchesSelector,e.matches(t||"*")};return"function"==typeof t&&(n=t),t instanceof e&&(n=function(e){return-1!==t._nodes.indexOf(e)}),new e(this._nodes.filter(n))}},{key:"eq",value:function(t){return new e(this._nodes[t])||!1}},{key:"get",value:function(e){return e&&e<=this._nodes.length?this._nodes[e]:this._nodes}},{key:"first",value:function(){return this._nodes[0]||!1}},{key:"slice",value:function(e){return e&&0!==e.length&&"string"!=typeof e&&"[object Function]"!==e.toString()?e.length?[].slice.call(e._nodes||e):[e]:[]}},{key:"unique",value:function(){return new e(this._nodes.reduce(function(e,t){return null!==t&&void 0!==t&&!1!==t&&-1===e.indexOf(t)?e.concat(t):e},[]))}},{key:"children",value:function(e){return this.map(function(e){return this.slice(e.children)}).filter(e)}},{key:"generate",value:function(t){return/^\s*<t(h|r|d)/.test(t)?new e(document.createElement("table")).html(t).children()._nodes:/^\s*</.test(t)?new e(document.createElement("div")).html(t).children()._nodes:document.createTextNode(t)}},{key:"args",value:function(e,t,n){return"function"==typeof e&&(e=e(t,n)),"string"!=typeof e&&(e=this.slice(e).map(this.str(t,n))),e.toString().split(/[\s,]+/).filter(function(e){return e.length})}},{key:"each",value:function(e){return this._nodes.forEach(e.bind(this)),this}},{key:"eacharg",value:function(e,t){return this.each(function(n,r){this.args(e,n,r).forEach(function(e){t.call(this,n,e)},this)})}},{key:"isInPage",value:function(e){return e!==document.body&&document.body.contains(e)}},{key:"map",value:function(t){return t?new e(this.array(t)).unique():this}},{key:"adjacent",value:function(t,n,r){return"number"==typeof n&&(n=0===n?[]:new Array(n).join().split(",").map(Number.call,Number)),this.each(function(o,i){var u=document.createDocumentFragment();new e(n||{}).map(function(n,r){var u="function"==typeof t?t.call(this,n,r,o,i):t;return"string"==typeof u?this.generate(u):new e(u)}).each(function(t){this.isInPage(t)?u.appendChild(new e(t).clone().first()):u.appendChild(t)}),r.call(this,o,u)})}},{key:"getAll",value:function(t){return new e([t].concat(new e("*",t)._nodes))}},{key:"clone",value:function(){return this.map(function(e){var t=e.cloneNode(!0),n=this.getAll(t);return this.getAll(e).each(function(e,t){for(var r in d)d[r](e,n._nodes[t])}),t})}},{key:"html",value:function(e){return void 0===e?this.first().innerHTML||"":this.each(function(t){t.innerHTML=e})}},{key:"text",value:function(e){return void 0===e?this.first().textContent||"":this.each(function(t){t.textContent=e})}},{key:"remove",value:function(){return this.each(function(e){e.parentNode.removeChild(e)})}},{key:"parent",value:function(e){return this.map(function(e){return e.parentNode}).filter(e)}},{key:"closest",value:function(t){return this.map(function(n){do{if(new e(n).is(t))return n}while((n=n.parentNode)&&n!==document)})}},{key:"append",value:function(e,t){return this.adjacent(e,t,function(e,t){e.appendChild(t)})}},{key:"prepend",value:function(e,t){return this.adjacent(e,t,function(e,t){e.insertBefore(t,e.firstChild)})}},{key:"find",value:function(t){return this.map(function(n){return new e(t||"*",n)})}},{key:"addClass",value:function(e){return this.eacharg(arguments,function(e,t){e.classList.add(t)})}},{key:"toggleClass",value:function(e){return this.eacharg(arguments,function(e,t){e.classList.toggle(t)})}},{key:"removeClass",value:function(e){return this.eacharg(arguments,function(e,t){e.classList.remove(t)})}},{key:"on",value:function(t,n,r){if("string"==typeof n){var o=n;n=function(t){var n=arguments,i=new e(t.currentTarget);(i.is(o)?i:i.find(o)).each(function(e){if(e===t.target||e.contains(t.target)){try{Object.defineProperty(t,"currentTarget",{get:function(){return e}})}catch(e){}r.apply(e,n)}})}}var i=function(e){return n.apply(this,[e].concat(e.detail||[]))};return this.eacharg(t,function(e,t){e.addEventListener(t,i),e._e=e._e||{},e._e[t]=e._e[t]||[],e._e[t].push(i)})}},{key:"off",value:function(t){return void 0===t&&this.each(function(e){for(var t in e._e)e._e[t].forEach(function(n){e.removeEventListener(t,n)})}),this.eacharg(t,function(t,n){new e(t._e?t._e[n]:[]).each(function(e){t.removeEventListener(n,e)})})}},{key:"trigger",value:function(e){var t=this.slice(arguments).slice(1);return this.eacharg(e,function(e,n){var r=void 0,o={bubbles:!0,cancelable:!0,detail:t};try{r=new window.CustomEvent(n,o)}catch(e){r=document.createEvent("CustomEvent"),r.initCustomEvent(n,!0,!0,t)}e.dispatchEvent(r)})}},{key:"attr",value:function(e,t,n){if(n=n?"data-":"",void 0!==t){var r=e;e={},e[r]=t}return"object"===(void 0===e?"undefined":i(e))?this.each(function(t){for(var r in e)null!==e[r]?t.setAttribute(n+r,e[r]):t.removeAttribute(n+r)}):this.length?this.first().getAttribute(n+e):""}},{key:"prop",value:function(e,t){if(void 0!==t){var n=e;e={},e[n]=t}return"object"===(void 0===e?"undefined":i(e))?this.each(function(t){for(var n in e)t[n]=e[n]}):this.length?this.first()[e]:""}},{key:"data",value:function(e,t){return e?this.attr(e,t,!0):this.first().dataset}},{key:"length",get:function(){return this._nodes.length}}]),e}(),v=function(){function e(t){u(this,e),this.registry=t}return c(e,[{key:"unlink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;Object.keys(this.registry.getData()).forEach(function(t){[].forEach.call(e.querySelectorAll(t),function(e){e.component&&e.component.$teardown()})})}},{key:"link",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;Object.keys(this.registry.getData()).forEach(function(r){[].forEach.call(n.querySelectorAll(r),function(n){if(!n.component){var o=t(n),i=o.data(),u=e.registry.getComponent(r);n.component=new u({element:o,data:i})}})})}}]),e}(),p=function(){function e(){u(this,e),this._registry={}}return c(e,[{key:"getData",value:function(){return this._registry}},{key:"getComponent",value:function(e){return this._registry[e]}},{key:"registerComponent",value:function(e,t){this._registry[e]=t}}]),e}(),m=new p,g=new v(m),b=t(document),k=function(e){if(e&&e.length>0){var t=e[0];return t instanceof HTMLElement?t:t.first()}},w=function(e){g.link(k(e)),b.trigger("strudel:loaded")},_=function(){b.on("content:loaded",function(e){w(e.detail)}),b.on("content:unload",function(e){g.unlink(k(e.detail))})},E={initializedClassName:"strudel-init"},O=function(e){return"function"==typeof e||!1},j=function(e,t){var n=e.prototype,r=t.prototype,o="object"===(void 0===t?"undefined":i(t))?t:new t;Object.getOwnPropertyNames(o).forEach(function(e){var t=Object.getOwnPropertyDescriptor(o,e);t.writable=!0,Object.defineProperty(n,e,t)}),Object.getOwnPropertyNames(r).forEach(function(e){"constructor"!==e&&Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})},C={},$=function(){function e(){u(this,e)}return c(e,[{key:"$on",value:function(e,t){C[e]||(C[e]=[]),C[e].push(t)}},{key:"$off",value:function(e,t){var n=C[e];if(n&&n.length){var r=n.reduce(function(e,n,r){return O(n)&&n===t?e=r:e},-1);if(r>-1)return n.splice(r,1),C[e]=n,!0}return!1}},{key:"$emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=C[e];return!(!o||!o.length)&&(o.forEach(function(e){e.apply(void 0,n)}),!0)}}],[{key:"getEvents",value:function(){return C}},{key:"removeAllListeners",value:function(){Object.keys(C).forEach(function(e){delete C[e]})}}]),e}(),S=/^(\S+)\s*(.*)$/,P=function(e,t,n,r){n?e.on(t,n,r):e.on(t,r)},x=function(e,t){return!!t&&Object.keys(t).forEach(function(n){var r=t[n],o=n.match(S);e.$element&&P(e.$element,o[1],o[2],r.bind(e))})},N=function(e,t){return!!t&&Object.keys(t).forEach(function(n){var r=t[n];e.$element&&(e[r]=e.$element.find(n))})},A=function(e,t){Object.keys(t).forEach(function(n){e[n]||(e[n]=t[n])})},D=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.element,r=e.data;u(this,t);var o=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.beforeInit(),o.$element=n,o.$data=r,x(o,o._events),N(o,o._els),o.mixins&&o.mixins.length&&o.mixins.forEach(function(e){O(e.init)&&e.init.call(o),A(o,e)}),o.init(),o.$element.addClass(E.initializedClassName),o}return a(t,e),c(t,[{key:"beforeInit",value:function(){}},{key:"init",value:function(){}},{key:"beforeDestroy",value:function(){}},{key:"destroy",value:function(){}},{key:"$teardown",value:function(){this.beforeDestroy(),this.$element.off(),this.$element.removeClass(E.initializedClassName),delete this.$element.first().scope,delete this.$element,this.destroy()}}]),t}($),L=function(e,t){if(!t)throw new Error("Selector must be provided for Component decorator");if(!e.prototype)throw new Error("Decorator works only for classes");var n=function(e){function t(){var e;u(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)))}return a(t,e),t}(D);return j(n,e),Object.defineProperty(n.prototype,"_selector",{value:t}),Object.defineProperty(n.prototype,"isStrudelClass",{value:!0}),m.registerComponent(t,n),n},T=E,M={components:m.getData()};!function(){/comp|inter|loaded/.test(document.readyState)?setTimeout(w,0):b.on("DOMContentLoaded",w),_()}(),e.version="0.7.0",e.options=M,e.config=T,e.EventEmitter=$,e.Component=n,e.Evt=r,e.El=o,e.element=t,e.$=t,Object.defineProperty(e,"__esModule",{value:!0})});